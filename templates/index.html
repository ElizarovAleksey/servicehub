<!DOCTYPE html>
<html lang="ru" class="bg-bg text-text min-h-screen">
<head>
  <meta charset="UTF-8">
  <title>ServiceHub</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.css') }}">

  <style>
    /* compact mode for new cards */
    body.compact a.card {
      padding: 1rem !important;
    }
    body.compact a.card p.desc {
      display: none;
    }
    body.compact a.card h3 {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }
    body.compact a.card .open-hint {
      display: none;
    }
    body.compact a.card:hover {
      transform: none;
    }
    body.compact .service-list {
      gap: 1rem !important;
    }

    /* drag cursor */
    .draggable-card { cursor: grab; }
    .draggable-card:active { cursor: grabbing; }

    /* prevent ugly text selection while dragging */
    .draggable-card, .draggable-card * { user-select: none; }
  </style>
</head>

<body class="bg-bg text-text min-h-screen bg-gradient-to-br from-bg via-bg to-bg/90">

<!-- HEADER -->
<header class="border-b border-border px-6 py-4 flex items-center justify-between bg-card/60 backdrop-blur">
  <div>
    <h1 class="text-xl font-semibold tracking-tight flex items-center gap-2">
      üß© ServiceHub
    </h1>
    <p class="text-xs text-muted">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã</p>
  </div>

  <div class="flex gap-2">
    <button id="toggleTheme"
      class="text-xs px-3 py-1.5 rounded-lg border border-border hover:bg-accent/10 transition">
      üåó –¢–µ–º–∞
    </button>

    <button id="toggleMode"
      class="text-xs px-3 py-1.5 rounded-lg border border-border hover:bg-accent/10 transition">
      –ö–æ–º–ø–∞–∫—Ç–Ω–æ
    </button>
  </div>
</header>

<!-- CONTENT -->
<main class="p-6 space-y-10 overflow-auto" style="height: calc(100vh - 100px);">

{% for group in groups %}

<section class="space-y-4 service-group" data-group="{{ group.name }}">

  <!-- Group header -->
  <div class="flex items-center gap-3">
    <div class="w-1.5 h-6 bg-accent rounded"></div>
    <h2 class="text-sm font-semibold tracking-wide uppercase text-muted">
      {{ group.name }}
    </h2>
  </div>

  <!-- Cards container (IMPORTANT for Sortable) -->
  <div class="service-list grid gap-6"
       style="grid-template-columns: repeat(auto-fill, minmax(260px, 300px));
              justify-content: start;">

    {% for s in group.services %}

    <a href="{{ s.url }}" target="_blank"
       class="card draggable-card group relative block
              bg-card/90
              rounded-2xl
              p-6
              border border-border/50
              transition duration-150 ease-out
              hover:-translate-y-0.5
              hover:shadow-lg
              dark:hover:shadow-[0_0_25px_rgba(255,255,255,0.08)]
              dark:hover:border-white/20
              dark:hover:bg-card"
       data-service="{{ s.id }}">

      <!-- status -->
      <div class="absolute top-4 right-4">
        {% if s.status == "ok" %}
          <span class="text-[11px] px-3 py-1 rounded-full bg-emerald-500/15 text-emerald-400 font-medium">
            ‚óè OK
          </span>
        {% elif s.status == "warning" %}
          <span class="text-[11px] px-3 py-1 rounded-full bg-amber-500/15 text-amber-400 font-medium">
            ‚óè WARN
          </span>
        {% else %}
          <span class="text-[11px] px-3 py-1 rounded-full bg-rose-500/15 text-rose-400 font-medium">
            ‚óè DOWN
          </span>
        {% endif %}
      </div>

      <h3 class="text-lg font-semibold mb-3 group-hover:text-accent transition">
        {{ s.name }}
      </h3>

      <p class="desc text-sm text-muted leading-relaxed mb-6">
        {{ s.description }}
      </p>

      <div class="open-hint text-sm text-accent opacity-0 group-hover:opacity-100 transition">
        –û—Ç–∫—Ä—ã—Ç—å ‚Üí
      </div>

    </a>

    {% endfor %}
  </div>
</section>

{% endfor %}
</main>

<footer class="text-center text-[10px] text-muted py-3 border-t border-border">
  ServiceHub ¬© {{ year }}
</footer>

<script>
  /* compact mode */
  const modeBtn = document.getElementById('toggleMode');

  function setMode(mode) {
    document.body.classList.toggle('compact', mode === 'compact');
    localStorage.setItem('servicehub-mode', mode);
    modeBtn.textContent = mode === 'compact' ? '–û–±—ã—á–Ω—ã–π' : '–ö–æ–º–ø–∞–∫—Ç–Ω–æ';
  }

  modeBtn.onclick = () => {
    setMode(document.body.classList.contains('compact') ? 'normal' : 'compact');
  };

  const savedMode = localStorage.getItem('servicehub-mode');
  if (savedMode) setMode(savedMode);

  /* theme */
  const themeBtn = document.getElementById('toggleTheme');
  const html = document.documentElement;

  themeBtn.onclick = () => {
    html.classList.toggle('dark');
    localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
  };

  if (localStorage.getItem('theme') === 'dark') {
    html.classList.add('dark');
  }

</script>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='js/servicehub.js') }}"></script>

</body>
</html>
